<jsp:root xmlns:jsp="http://java.sun.com/JSP/Page"
          xmlns="http://www.w3.org/1999/xhtml"
          xmlns:spring="http://www.springframework.org/tags"
          xmlns:spring-form="http://www.springframework.org/tags/form"
          xmlns:security="http://www.springframework.org/security/tags"
          xmlns:c="http://java.sun.com/jsp/jstl/core"
          xmlns:x="http://java.sun.com/jsp/jstl/xml"
          xmlns:fmt="http://java.sun.com/jsp/jstl/fmt"
          xmlns:tiles="http://tiles.apache.org/tags-tiles"
          xmlns:fn="http://java.sun.com/jsp/jstl/functions" version="2.0">
    <jsp:directive.page pageEncoding="UTF-8" contentType="text/html; charset=UTF-8"/>

    <c:choose>
        <c:when test="${platform == true}">
            <c:set var="closeId" value="${organization.id}_platformLicenseTable"/>
        </c:when>
        <c:otherwise>
            <c:set var="closeId" value="${organization.id}_applicationLicenseTable"/>
        </c:otherwise>
    </c:choose>


    <spring:message var="option1" code="form.select" text="-- Please Select --"/>

    <spring-form:form id="form" commandName="organizationLicenseForm" action="/secure/organization/licensed/application/edit.admin" method="POST">

        <table>
            <tr>
                <td colspan="2"><spring:message code="organization.license.help" text="Select the applications you want to license"/></td>
            </tr>
            <tr valign="top">
                <td width="100" class="form_text"><spring:message code="application.name" text="Name"/>:&#160;</td>
                <td width="250">
                    <select name="licenseIds" multiple="multiple" class="multiSelect">
                        <c:forEach items="${licenses}" var="lic" varStatus="status">
                            <c:set var="licenseExists" value="false"/>

                            <c:forEach items="${organizationLicenseForm.licenseIds}" var="existingLicenseId">
                                <c:if test="${lic.id == existingLicenseId}">
                                    <c:set var="licenseExists" value="true"/>
                                </c:if>
                            </c:forEach>

                            <c:choose>
                                <c:when test="${licenseExists}">
                                    <option value="${lic.id}" selected="selected">${lic.application.name} - ${lic.name} - ${lic.licenseType}</option>
                                </c:when>
                                <c:otherwise>
                                    <option value="${lic.id}">${lic.application.name} - ${lic.name} - ${lic.licenseType}</option>
                                </c:otherwise>
                            </c:choose>

                            <c:set var="licenseExists" value="false"/>
                        </c:forEach>
                    </select>
                </td>
            </tr>
            <tr>
                <td colspan="2">
                    <input type="hidden" name="organizationId" value="${organization.id}"/>
                    <input type="hidden" name="platform" value="${platform}"/>
                </td>
            </tr>
        </table>

    </spring-form:form>

</jsp:root>