<jsp:root xmlns:jsp="http://java.sun.com/JSP/Page"
          xmlns="http://www.w3.org/1999/xhtml"
          xmlns:spring="http://www.springframework.org/tags"
          xmlns:spring-form="http://www.springframework.org/tags/form"
          xmlns:security="http://www.springframework.org/security/tags"
          xmlns:c="http://java.sun.com/jsp/jstl/core"
          xmlns:x="http://java.sun.com/jsp/jstl/xml"
          xmlns:fmt="http://java.sun.com/jsp/jstl/fmt"
          xmlns:tiles="http://tiles.apache.org/tags-tiles"
          xmlns:fn="http://java.sun.com/jsp/jstl/functions" version="2.0">
    <!--<jsp:output doctype-root-element="html"-->
                <!--doctype-public="-//W3C//DTD XHTML 1.1//EN"-->
                <!--doctype-system="http://www.w3.org/TR/xhtml11/DTD/xhtml11.dtd"/>-->
    <jsp:directive.page pageEncoding="UTF-8" contentType="text/html; charset=UTF-8"/>

    <spring:message var="cmsHost" code="http.base.url" text="http://localhost:8888"/>

    <html xmlns="http://www.w3.org/1999/xhtml">
    <head>
        <title>${application.name}</title>

        <tiles:importAttribute name="stylesheets"/>
        <!-- loops through the list of stylesheets -->
        <c:forEach var="stylesheet" items="${stylesheets}">
            <style type="text/css" media="screen">@import url( "${stylesheet}" );</style>
        </c:forEach>

        <tiles:importAttribute name="javascripts"/>
        <!-- loops through the list of javascripts -->
        <c:forEach var="javascript" items="${javascripts}">
            <script language="javascript" type="text/javascript" src="${javascript}"><!----></script>
        </c:forEach>

        <c:if test="${dto != null}">
        <script type="text/javascript">
            <![CDATA[
        $(document).ready(function() {
            var flashvars = {
                host: "${pageContext.request.serverName}",
                port: "${pageContext.request.serverPort}",
                contextRoot: "${pageContext.request.contextPath}",
                organizationId: "${organizationId}",
                applicationId: "${applicationId}",
                ${dto.configurationForJSON}
            };
            var params = {
                allowScriptAccess:"always",
                quality:"high",
                bgcolor:"#f6f6f6"
            };
            var attributes = {
                id:"${dto.application.id}",
                name:"${dto.application.id}"
            };
            swfobject.embedSWF("${cmsHost}${dto.application.swfUrl}", "${dto.application.id}", "100%", "100%", "9.0.0", "expressInstall.swf", flashvars, params, attributes);
        });
            ]]>
        </script>
        </c:if>
    </head>

    <body>

        <c:choose>
            <c:when test="${dto != null}">
                <div id="${dto.application.id}">
                    <p>This content requires the Adobe Flash Player. <a href="http://www.adobe.com/go/getflash/">Get Flash</a></p>
                </div>
            </c:when>
            <c:otherwise>
                <spring:message code="application.launch.empty" text="Flash application could not be found or it is not yet ready for consumption."/>
            </c:otherwise>
        </c:choose>

    </body>
    </html>
</jsp:root>